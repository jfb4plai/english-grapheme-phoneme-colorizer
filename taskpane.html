<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Grapheme-Phoneme Colorizer</title>
    
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 25px;
            font-style: italic;
        }
        
        .control-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e3f2fd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        
        .control-title {
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: white;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        button {
            background-color: #6c5ce7;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            min-width: 120px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background-color: #5a4fcf;
            transform: translateY(-1px);
        }
        
        button.clear-btn {
            background-color: #fd79a8;
        }
        
        button.clear-btn:hover {
            background-color: #e84393;
        }
        
        button.analyze-btn {
            background-color: #00b894;
            width: 100%;
            margin-top: 10px;
        }
        
        button.analyze-btn:hover {
            background-color: #00a085;
        }
        
        .button-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .color-legend {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #6c5ce7;
        }
        
        .legend-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 8px;
        }
        
        .legend-item {
            padding: 6px 10px;
            border-radius: 15px;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }
        
        .notice {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            color: #856404;
            text-align: center;
            font-size: 13px;
        }
        
        .info {
            background-color: #d1ecf1;
            border: 1px solid #b3d7ff;
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            color: #0c5460;
            font-size: 13px;
        }
        
        .status-message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info-msg { background: #d1ecf1; color: #0c5460; border: 1px solid #b3d7ff; }
    </style>
</head>

<body>
    <div class="container">
        <h1>üß† Grapheme-Phoneme</h1>
        <p class="subtitle">Visualizing English sound-spelling correspondences</p>
        
        <div class="control-section">
            <div class="control-title">Coloring Strategy:</div>
            <select id="coloringStrategy">
                <option value="phoneme">Phoneme-based</option>
                <option value="grapheme">Grapheme-based</option>
                <option value="difficulty">Difficulty-based</option>
            </select>
        </div>
        
        <div class="control-section">
            <div class="control-title">Apply to:</div>
            <select id="applyTo">
                <option value="selection">Selected text</option>
                <option value="paragraph">Current paragraph</option>
                <option value="document">Entire document</option>
            </select>
        </div>
        
        <div class="button-row">
            <button id="colorizeBtn" onclick="colorizeText()">üé® Colorize</button>
            <button class="clear-btn" id="clearBtn" onclick="clearFormatting()">üóëÔ∏è Clear</button>
        </div>
        
        <button class="analyze-btn" id="analyzeBtn" onclick="analyzeDifficulty()">üìä Analyze Difficulty</button>
        
        <div class="color-legend">
            <div class="legend-title">
                üìö Color Legend
            </div>
            <div class="legend-grid">
                <div class="legend-item" style="background-color: #FF6B6B;">Simple Vowels</div>
                <div class="legend-item" style="background-color: #FFD93D;">Complex Vowels</div>
                <div class="legend-item" style="background-color: #6BCF7F;">Simple Consonants</div>
                <div class="legend-item" style="background-color: #4D96FF;">Complex Consonants</div>
                <div class="legend-item" style="background-color: #9B59B6;">Silent Letters</div>
                <div class="legend-item" style="background-color: #E17055;">Irregular</div>
                <div class="legend-item" style="background-color: #F39C12;">Morphemes</div>
            </div>
        </div>
        
        <div class="notice">
            ‚ö†Ô∏è This add-in works best in Microsoft Word
        </div>
        
        <div class="info">
            <strong>For Dyslexia Support:</strong><br>
            This tool helps visualize grapheme-phoneme correspondences to aid in understanding the relationship between written letters and their sounds.
        </div>
        
        <div id="statusArea"></div>
    </div>

    <script>
        // Global variables
        let isInWord = false;
        
        // Grapheme color mapping
        const colorMap = {
            vowels: '#FF6B6B',
            consonants: '#4ECDC4',
            digraphs: '#6C5CE7',
            trigraphs: '#E17055',
            silent: '#95A5A6'
        };

        // Initialize Office Add-in
        if (typeof Office !== 'undefined') {
            Office.onReady(function(info) {
                console.log('Office.js initialized');
                
                if (info.host === Office.HostType.Word) {
                    console.log('Word environment detected');
                    isInWord = true;
                    showMessage('Connected to Microsoft Word', 'success');
                } else {
                    console.log('Non-Word environment');
                    showMessage('Running in demo mode - install in Word for full functionality', 'warning');
                }
            });
        } else {
            console.log('Office.js not available - demo mode');
            showMessage('Office.js not available - running in browser demo mode', 'info-msg');
        }

        // Colorize text function
        function colorizeText() {
            console.log('Colorize function called');
            
            if (!isInWord) {
                showMessage('Demo: Colorization would apply grapheme-phoneme patterns', 'info-msg');
                return;
            }

            Word.run(function(context) {
                try {
                    const applyTo = document.getElementById('applyTo').value;
                    let range;
                    
                    if (applyTo === 'selection') {
                        range = context.document.getSelection();
                    } else if (applyTo === 'paragraph') {
                        range = context.document.getSelection().paragraphs.getFirst();
                    } else {
                        range = context.document.body;
                    }
                    
                    range.load('text');
                    
                    return context.sync().then(function() {
                        const text = range.text;
                        console.log('Text to colorize:', text);
                        
                        if (!text || text.trim() === '') {
                            showMessage('No text found to colorize', 'warning');
                            return context.sync();
                        }
                        
                        // Apply basic colorization
                        return applyBasicColorization(range, text, context);
                    });
                    
                } catch (error) {
                    console.error('Error in colorizeText:', error);
                    showMessage('Error applying colorization: ' + error.message, 'error');
                }
            }).catch(function(error) {
                console.error('Word.run error:', error);
                showMessage('Word API error: ' + error.message, 'error');
            });
        }

        // Clear formatting function
        function clearFormatting() {
            console.log('Clear formatting called');
            
            if (!isInWord) {
                showMessage('Demo: Would clear all color formatting', 'info-msg');
                return;
            }

            Word.run(function(context) {
                try {
                    const applyTo = document.getElementById('applyTo').value;
                    let range;
                    
                    if (applyTo === 'selection') {
                        range = context.document.getSelection();
                    } else if (applyTo === 'paragraph') {
                        range = context.document.getSelection().paragraphs.getFirst();
                    } else {
                        range = context.document.body;
                    }
                    
                    range.load('text');
                    
                    return context.sync().then(function() {
                        if (!range.text || range.text.trim() === '') {
                            showMessage('No text found to clear', 'warning');
                            return context.sync();
                        }
                        
                        // Clear font formatting
                        range.font.color = '#000000';
                        range.font.bold = false;
                        
                        return context.sync().then(function() {
                            showMessage('Formatting cleared successfully', 'success');
                        });
                    });
                    
                } catch (error) {
                    console.error('Error in clearFormatting:', error);
                    showMessage('Error clearing formatting: ' + error.message, 'error');
                }
            }).catch(function(error) {
                console.error('Word.run error in clearFormatting:', error);
                showMessage('Word API error: ' + error.message, 'error');
            });
        }

        // Apply basic colorization
        function applyBasicColorization(range, text, context) {
            console.log('Applying basic colorization');
            
            // Determine primary grapheme type
            let color = colorMap.consonants; // default
            
            if (/[aeiouAEIOU]/.test(text)) {
                color = colorMap.vowels;
            }
            
            if (/th|ch|sh|wh|ph|gh/i.test(text)) {
                color = colorMap.digraphs;
                range.font.bold = true;
            }
            
            // Apply the color
            range.font.color = color;
            
            return context.sync().then(function() {
                showMessage('Colorization applied successfully', 'success');
                console.log('Colorization completed');
            });
        }

        // Analyze difficulty function
        function analyzeDifficulty() {
            console.log('Analyze difficulty called');
            
            if (!isInWord) {
                showMessage('Demo: Would analyze text difficulty and suggest improvements', 'info-msg');
                return;
            }

            Word.run(function(context) {
                try {
                    const selection = context.document.getSelection();
                    selection.load('text');
                    
                    return context.sync().then(function() {
                        const text = selection.text;
                        
                        if (!text || text.trim() === '') {
                            showMessage('Please select text to analyze', 'warning');
                            return;
                        }
                        
                        // Simple analysis
                        const wordCount = text.split(/\s+/).length;
                        const hasDigraphs = /th|ch|sh|wh|ph|gh/i.test(text);
                        const hasComplexVowels = /ai|ay|ea|ee|ie|oa|oo|ou|ow|ue/i.test(text);
                        
                        let difficulty = 'Easy';
                        if (hasDigraphs && hasComplexVowels) {
                            difficulty = 'Hard';
                        } else if (hasDigraphs || hasComplexVowels) {
                            difficulty = 'Medium';
                        }
                        
                        showMessage(`Analysis: ${wordCount} words, Difficulty: ${difficulty}`, 'info-msg');
                    });
                    
                } catch (error) {
                    console.error('Error in analyzeDifficulty:', error);
                    showMessage('Error analyzing text: ' + error.message, 'error');
                }
            }).catch(function(error) {
                console.error('Word.run error in analyzeDifficulty:', error);
            });
        }

        // Show status message
        function showMessage(message, type) {
            const statusArea = document.getElementById('statusArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `status-message ${type}`;
            messageDiv.textContent = message;
            
            // Clear previous messages
            statusArea.innerHTML = '';
            statusArea.appendChild(messageDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        console.log('Taskpane script loaded successfully');
    </script>
</body>
</html>
